- name: Build Backend Image (for tests)
  uses: docker/build-push-action@v5
  with:
    context: ./backend
    load: true
    tags: vempatisriram2004/capstone-backend:test

- name: Run Backend Tests
  run: docker run --rm vempatisriram2004/capstone-backend:test python -m pytest /app/test_app.py -q -o cache_dir=/tmp/pytest

- name: Push Backend Image
  uses: docker/build-push-action@v5
  with:
    context: ./backend
    push: true
    tags: vempatisriram2004/capstone-backend:latest
